
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Communicating through the Webserver &#8212; DFObserve Manual</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reponses from the Webserver" href="WebRequestSummary.html" />
    <link rel="prev" title="QuickObserve" href="QuickObserve.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">DFObserve Manual</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    DFObserve Guide
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Manual
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Observation.html">
   The Observation Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="AutoObserve.html">
   The AutoObserve Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="QuickObserve.html">
   QuickObserve
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Communicating through the Webserver
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="WebRequestSummary.html">
   Reponses from the Webserver
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Utilities.html">
   Utilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CLI.html">
   Command Line Interface
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="api.html">
   API documentation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="_autosummary/dfobserve.html">
     dfobserve
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="_autosummary/dfobserve.checks.html">
       dfobserve.checks
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
      <label for="toctree-checkbox-3">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.checks.check_cameras.html">
         dfobserve.checks.check_cameras
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.checks.check_dragonfly.html">
         dfobserve.checks.check_dragonfly
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.checks.check_filters.html">
         dfobserve.checks.check_filters
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.checks.check_focusers.html">
         dfobserve.checks.check_focusers
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.checks.check_mount.html">
         dfobserve.checks.check_mount
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="_autosummary/dfobserve.exceptions.html">
       dfobserve.exceptions
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.exceptions.exceptions.html">
         dfobserve.exceptions.exceptions
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="_autosummary/dfobserve.logging.html">
       dfobserve.logging
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.logging.logger.html">
         dfobserve.logging.logger
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="_autosummary/dfobserve.observing.html">
       dfobserve.observing
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
      <label for="toctree-checkbox-6">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.observing.AutoObserve.html">
         dfobserve.observing.AutoObserve
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.observing.Observation.html">
         dfobserve.observing.Observation
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="_autosummary/dfobserve.utils.html">
       dfobserve.utils
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
      <label for="toctree-checkbox-7">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.CameraUtils.html">
         dfobserve.utils.CameraUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.FilterTilterUtils.html">
         dfobserve.utils.FilterTilterUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.FlipFlatUtils.html">
         dfobserve.utils.FlipFlatUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.FocuserUtils.html">
         dfobserve.utils.FocuserUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.HardwareUtils.html">
         dfobserve.utils.HardwareUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.MountUtils.html">
         dfobserve.utils.MountUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.NMS_utils.html">
         dfobserve.utils.NMS_utils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.NetworkUtils.html">
         dfobserve.utils.NetworkUtils
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.utils.SkyXUtils.html">
         dfobserve.utils.SkyXUtils
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="_autosummary/dfobserve.webserver.html">
       dfobserve.webserver
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
      <label for="toctree-checkbox-8">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="_autosummary/dfobserve.webserver.WebRequests.html">
         dfobserve.webserver.WebRequests
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Webserver.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Webserver.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sendcommand">
   SendCommand
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sendwebrequestnb">
   SendWebRequestNB
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Communicating through the Webserver</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sendcommand">
   SendCommand
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sendwebrequestnb">
   SendWebRequestNB
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="communicating-through-the-webserver">
<h1>Communicating through the Webserver<a class="headerlink" href="#communicating-through-the-webserver" title="Permalink to this headline">#</a></h1>
<p>At a fundamental level, everything is handled by web requests sent through a web server to some or all of the raspberry pis that control each unit.</p>
<section id="sendcommand">
<h2>SendCommand<a class="headerlink" href="#sendcommand" title="Permalink to this headline">#</a></h2>
<p>The basic function for carrying out a command is</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dfobserve.webserver</span> <span class="kn">import</span> <span class="n">SendCommand</span>
</pre></div>
</div>
</div>
</div>
<p>who’s simple docs look like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SendCommand</span><span class="p">(</span><span class="n">command</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</pre></div>
</div>
</div>
</div>
<p>This function takes a url string command that is recognized by the server. This can be simple, like <code class="docutils literal notranslate"><span class="pre">'status'</span></code>, or complex, like <code class="docutils literal notranslate"><span class="pre">'expose?type=light&amp;time={exptime}&amp;name={name}'</span></code>.</p>
<p>The function needs the <code class="docutils literal notranslate"><span class="pre">ip</span></code> address to send it to (on the local network), and how long to wait before timing out on no response. One can also add the name of the unit (e.g., “Dragonfly301”) for prettier printing; this is done automatically when some other functions run this command. The main <code class="docutils literal notranslate"><span class="pre">SendWebRequest</span></code> below essentially wraps this function (which does some checks on what gets returned), and determines which commands should go to which IP addresses,</p>
</section>
<section id="sendwebrequestnb">
<h2>SendWebRequestNB<a class="headerlink" href="#sendwebrequestnb" title="Permalink to this headline">#</a></h2>
<p>The big boy of this module is <code class="docutils literal notranslate"><span class="pre">SendWebRequestNB</span></code>, which provides the flexibility to send different commands to all of the different subsystems on the instrument. Its setup looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SendWebRequestNB</span><span class="p">(</span><span class="n">command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">which</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                    <span class="n">ha_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">oiii_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ha_off_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">oiii_off_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">OH_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">OH_off_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">all_cals_command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">wait_for_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="n">timeout_global</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>
                    <span class="n">timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="n">dryrun</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</pre></div>
</div>
</div>
</div>
<p>In simpler cases, we have a single command we want to send to all, or a simply-defined subset of the units. For example, we might want to send the <code class="docutils literal notranslate"><span class="pre">AllCloseFlipFlats()</span></code> base (web) command, and we know it should just go to the science units (since the others don’t have flip flats). Indeed, the way the <code class="docutils literal notranslate"><span class="pre">AllCloseFlipFlats</span></code> assumes we want just the science frames. So under the hood, it runs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SendWebRequestNB</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;flipflat?command=close&amp;remote=true&#39;</span><span class="p">,</span>
                              <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">,</span>
                              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>where in this case, <code class="docutils literal notranslate"><span class="pre">which</span></code> is going to be set to <code class="docutils literal notranslate"><span class="pre">'science'</span></code>. The currently supported options are ‘all’, ‘science’, ‘science offs’, and ‘OH’ (which sends to both the OH on and OH off units).</p>
<p>Beyond this simple usage, we have optional keyword arguments for every single type of unit we have, separately, as well as one for all the cals together. So if we need to send different commands to h-alpha and oiii, we can do that.</p>
<p>Indeed, these special keywords <em>overwrite</em> the default command. So we could send a command to ‘all’ using the primary command, and then just overwrite what gets sent to OIII with a separate command.</p>
<p>Finally, we have some flags like verbose (print stuff), whether to try to wait for the sticks to <em>complete</em> the command (for up to <code class="docutils literal notranslate"><span class="pre">timeout_global</span></code> seconds), and the timeout in seconds for individual connections to send a response before being marked down with the connexction closing. <code class="docutils literal notranslate"><span class="pre">dryrun</span></code> lets us queue a command and look at what we’re going to send to each unit in a table before we actually pull the trigger.</p>
<p>The Modules inside the <code class="docutils literal notranslate"><span class="pre">utils</span></code> submodule, e.g., <code class="docutils literal notranslate"><span class="pre">CameraUtils</span></code>, or as we’ve seen, <code class="docutils literal notranslate"><span class="pre">FlipFlatUtils</span></code>, are basically wrappers around <code class="docutils literal notranslate"><span class="pre">SendWebRequestNB</span></code>, allowing you to queue up somewhat complex commands without actually messing with a lot of options or remembering the string-based url-type commands. But you can always resort to this.</p>
<p>For example, you could write a “fully manual” observing script that specifies in serial every command to send using this. You can also easily <em>add</em> convenience functions by wrapping this function and deciding on which things it will set up automatically.</p>
<p>To give a concrete example, let’s look at the bread and butter command: <code class="docutils literal notranslate"><span class="pre">AllScienceExposure</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">AllScienceExposure</span><span class="p">(</span><span class="n">exptime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">off_exptime</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">n_offs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">oh_exptime</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">alt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">wait_readout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Execute a standard science exposure</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;expose?type=light&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">command</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&amp;name=</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ra</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">command</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&amp;ra=</span><span class="si">{</span><span class="n">ra</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dec</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">command</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&amp;dec=</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alt</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">command</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&amp;alt=</span><span class="si">{</span><span class="n">alt</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">az</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
        <span class="n">command</span><span class="o">+=</span><span class="sa">f</span><span class="s2">&quot;&amp;az=</span><span class="si">{</span><span class="n">az</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">science_command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&amp;time=</span><span class="si">{</span><span class="n">exptime</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">offs_command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&amp;time=</span><span class="si">{</span><span class="n">off_exptime</span><span class="si">}</span><span class="s2">&amp;nlight=</span><span class="si">{</span><span class="n">n_offs</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oh_exptime</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">oh_command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;&amp;time=</span><span class="si">{</span><span class="n">oh_exptime</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">oh_command</span> <span class="o">=</span> <span class="n">science_command</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">exptime</span><span class="o">+</span><span class="n">wait_readout</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">SendWebRequestNB</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">offs_command</span><span class="p">,</span>
                                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;science offs&#39;</span><span class="p">,</span>
                                <span class="n">ha_command</span><span class="o">=</span><span class="n">science_command</span><span class="p">,</span>
                                <span class="n">oiii_command</span><span class="o">=</span><span class="n">science_command</span><span class="p">,</span>
                                <span class="n">OH_command</span><span class="o">=</span><span class="n">oh_command</span><span class="p">,</span>
                                <span class="n">OH_off_command</span><span class="o">=</span><span class="n">oh_command</span><span class="p">,</span>
                                <span class="n">timeout_global</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
</div>
</div>
<p>This function is responsible for (in most case) executing the science exposures. It reads in some specific things fed to it by <code class="docutils literal notranslate"><span class="pre">AutoObserve</span></code>, retrieved from an object’s observing plan. It allows for the OH-band exptime to be set (but if it isn’t, uses the science exposure time). It sets up the string commands for the science and offs, telling the offs to do n iterations (based on other calculations). And at the end, we can see it wraps <code class="docutils literal notranslate"><span class="pre">SendWebRequestNB</span></code>.</p>
<p>Ironically, the shortest way was by setting the <code class="docutils literal notranslate"><span class="pre">offs_command</span></code> to the primary, with <code class="docutils literal notranslate"><span class="pre">which</span> <span class="pre">=</span> <span class="pre">'science</span> <span class="pre">offs'</span></code>, which handles the ha and oiii offbands. Then we feed the science command to both ha and oiii, and the oh_command to both oh and oh off. And we use a special global timeout set to the exposure time plus some number of seconds, to ensure the script waits the length of the exposure plus some read out time, before closing.</p>
<p><code class="docutils literal notranslate"><span class="pre">SendWebRequestNB</span></code> constructs a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> to store all the commands it is going to send where; this data frame with the responses at the time it finishes (either all sticks respond as ‘SUCCESS’ or the timeout is reached) is returned and added to the log (or printed for examination).</p>
<p>Let’s say we want to tilt Halpha filters to 12 degrees. We’d run</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">SendWebRequestNB</span><span class="p">(</span><span class="n">ha_command</span><span class="o">=</span><span class="s1">&#39;device/filtertilter?command=set&amp;argument=12&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This would send the request only to the Halpha units. Alternatively,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SendWebRequestNB</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;device/filtertilter?command=set&amp;argument=12&#39;</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;science&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>would tilt both the Halpha and OIII filters to this amount, and</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SendWebRequestNB</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;device/filtertilter?command=set&amp;argument=12&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>would send it to all units (even the calibration ones).</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="QuickObserve.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">QuickObserve</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="WebRequestSummary.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reponses from the Webserver</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Imad Pasha<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>